<!DOCTYPE html>
<html>
<head>
    <title>Account Settings</title>
    <link href="css/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:700,900" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #ff00cc 0%, #333399 100%);
            min-height: 100vh;
            font-family: 'Ubuntu', sans-serif;
        }
        .settings-section {
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            box-shadow: 0 0 20px #ff00cc99;
            margin: 60px auto 0 auto;
            padding: 40px 50px 30px 50px;
            max-width: 400px;
            text-align: center;
        }
        .settings-section input {
            width: 90%;
            margin-bottom: 14px;
            padding: 7px 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
        }
        .settings-section label {
            float: left;
            margin-left: 5%;
            font-weight: bold;
            color: #333399;
        }
        .buttons.danger {
            background: #ff0033;
            color: #fff;
        }
        #backBtn {
            position: fixed;
            top: 18px;
            left: 24px;
            font-size: 0.95em;
            padding: 6px 16px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <a href="landing.html" id="backBtn" class="buttons disco-btn">&larr; Back</a>
    <div class="settings-section">
        <h2>Account Settings</h2>
        <form onsubmit="saveSettings(); return false;">
            <label for="settingsUsername">Username:</label><br>
            <input type="text" id="settingsUsername" value="" required /><br>
            <label for="settingsFirstName">First Name:</label><br>
            <input type="text" id="settingsFirstName" value="" required /><br>
            <label for="settingsLastName">Last Name:</label><br>
            <input type="text" id="settingsLastName" value="" required /><br>
            <label for="settingsPassword">Password:</label><br>
            <input type="password" id="settingsPassword" value="" placeholder="Leave blank to keep current" /><br>
            <button type="submit" class="buttons disco-btn">Save Changes</button>
            <button type="button" class="buttons disco-btn danger" style="float:right;" onclick="signOut();">Sign Out</button>
        </form>
        <div id="settingsResult" style="margin-top:18px;"></div>
    </div>
    <script>
        // Load user info from cookie
        window.onload = function() {
            let data = document.cookie;
            let splits = data.split(",");
            let username = "";
            let firstName = "";
            let lastName = "";
            let userId = "";
            for(let i = 0; i < splits.length; i++) {
                let thisOne = splits[i].trim();
                let tokens = thisOne.split("=");
                if(tokens[0] == "firstName") firstName = tokens[1];
                else if(tokens[0] == "lastName") lastName = tokens[1];
                else if(tokens[0] == "userId") userId = tokens[1];
                else if(tokens[0] == "login") username = tokens[1];
            }
            document.getElementById('settingsUsername').value = username;
            document.getElementById('settingsFirstName').value = firstName;
            document.getElementById('settingsLastName').value = lastName;
        };
        function saveSettings() {
            let username = document.getElementById('settingsUsername').value;
            let firstName = document.getElementById('settingsFirstName').value;
            let lastName = document.getElementById('settingsLastName').value;
            let password = document.getElementById('settingsPassword').value;
            let userId = null;
            let data = document.cookie;
            let splits = data.split(",");
            for(let i = 0; i < splits.length; i++) {
                let thisOne = splits[i].trim();
                let tokens = thisOne.split("=");
                if(tokens[0] == "userId") userId = tokens[1];
            }
            let tmp = { userId: userId, login: username, firstName: firstName, lastName: lastName, password: password };
            let jsonPayload = JSON.stringify(tmp);
            let url = 'http://178.128.4.96/LAMPAPI/UpdateUser.php'; // You need to implement this endpoint
            let xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    let jsonObject = JSON.parse(xhr.responseText);
                    if (!jsonObject.error) {
                        document.getElementById('settingsResult').innerHTML = "Account updated!";
                    } else {
                        document.getElementById('settingsResult').innerHTML = jsonObject.error;
                    }
                }
            };
            xhr.send(jsonPayload);
        }
        function signOut() {
            document.cookie = "firstName= ; expires = Thu, 01 Jan 1970 00:00:00 GMT";
            document.cookie = "lastName= ; expires = Thu, 01 Jan 1970 00:00:00 GMT";
            document.cookie = "userId= ; expires = Thu, 01 Jan 1970 00:00:00 GMT";
            window.location.href = "index.html";
        }
    </script>
</body>
</html>
