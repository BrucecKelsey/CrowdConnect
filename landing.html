<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Crowd Connect</title>
    <link href="css/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        :root {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --primary: 217.2 91.2% 59.8%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
            --radius: 0.5rem;
        }
        body {
            font-family: 'Poppins', 'PT Sans', 'Ubuntu', sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 64rem;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            width: 100%;
            max-width: 56rem;
            margin: 0 auto 1rem auto;
        }
        .header-inner {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 0.5rem 0 1.5rem 0;
        }
        .header-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .logo-svg {
            height: 3rem;
            width: 3rem;
            color: hsl(var(--primary));
        }
        .headline {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Poppins', 'PT Sans', 'Ubuntu', sans-serif;
            letter-spacing: -0.02em;
        }
        main {
            width: 100%;
            max-width: 56rem;
            margin: 0 auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .card {
            border-radius: 0.5rem;
            border: 1px solid hsl(var(--border));
            background: hsl(var(--card));
            color: hsl(var(--card-foreground));
            box-shadow: 0 2px 8px 0 hsl(var(--primary) / 0.08);
        }
        .card.shadow-lg {
            box-shadow: 0 4px 24px 0 hsl(var(--primary) / 0.18);
        }
        .card-header {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 1rem 1rem 1rem;
        }
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            font-family: 'Poppins', 'PT Sans', 'Ubuntu', sans-serif;
        }
        .card-desc {
            font-size: 1rem;
            color: hsl(var(--muted-foreground));
        }
        .card-content {
            padding: 1.5rem 1rem 1rem 1rem;
        }
        .empty-events {
            text-align: center;
            padding: 3rem 1.5rem;
            border: 2px dashed hsl(var(--border));
            border-radius: 0.5rem;
        }
        .empty-events svg {
            margin: 0 auto;
            display: block;
        }
        .empty-events h3 {
            margin-top: 1rem;
            font-size: 1.125rem;
            font-weight: 600;
            font-family: 'Poppins', 'PT Sans', 'Ubuntu', sans-serif;
        }
        .empty-events p {
            margin-top: 0.25rem;
            font-size: 0.95rem;
            color: hsl(var(--muted-foreground));
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border: none;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px hsl(var(--primary) / 0.2);
        }

        .btn:hover {
            background: hsl(var(--primary) / 0.9);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px hsl(var(--primary) / 0.2);
        }

        .btn-secondary {
            background: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        .btn-secondary:hover {
            background: hsl(var(--secondary) / 0.9);
        }

        .btn-container {
            display: flex;
            justify-content: flex-end;
        }
        .w-full { width: 100%; }
        .gap-2 { gap: 0.5rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-lg { box-shadow: 0 4px 24px 0 hsl(var(--primary) / 0.18); }
        .shadow-sm { box-shadow: 0 2px 8px 0 hsl(var(--primary) / 0.08); }
        .mt-4 { margin-top: 1rem; }
        .ml-2 { margin-left: 0.5rem; }
        .underline-offset-4 { text-underline-offset: 4px; }
        .hover\:underline:hover { text-decoration: underline; }
        .text-muted-foreground { color: hsl(var(--muted-foreground)); }
        .text-primary { color: hsl(var(--primary)); }
        .text-primary-foreground { color: hsl(var(--primary-foreground)); }
    </style>
</head>
<body class="font-body antialiased min-h-screen bg-background">
    <div class="container">
        <header class="w-full max-w-4xl mx-auto mb-4">
            <div class="header-inner">
                <div class="header-row">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="logo-svg"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                    <h1 class="headline">Crowd Connect</h1>
                </div>
            </div>
        </header>
        <main class="w-full flex flex-col gap-8 max-w-4xl mx-auto flex-grow">
            <div>
                <div class="rounded-lg border bg-card text-card-foreground shadow-lg">
                    <div class="space-y-1.5 flex flex-row items-center p-4">
                        <div class="flex-grow">
                            <div class="font-semibold tracking-tight font-headline text-2xl">Your Events</div>
                            <div class="text-sm text-muted-foreground">Create and manage your events. Set one to 'Active' to receive song requests.</div>
                        </div>
                        <button class="btn" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-plus"><circle cx="12" cy="12" r="10"></circle><path d="M8 12h8"></path><path d="M12 8v8"></path></svg>
                            Create Event
                        </button>
                    </div>
                    <div class="p-6 pt-0">
                        <div class="text-center py-12 px-6 border-2 border-dashed rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-music mx-auto h-12 w-12 text-muted-foreground"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                            <h3 class="mt-4 text-lg font-semibold font-headline">No events yet</h3>
                            <p class="mt-1 text-sm text-muted-foreground">Click "Create Event" to get started.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                    <div class="flex flex-col space-y-1.5 p-6">
                        <div class="text-2xl font-semibold leading-none tracking-tight font-headline flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-qr-code"><rect width="5" height="5" x="3" y="3" rx="1"></rect><rect width="5" height="5" x="16" y="3" rx="1"></rect><rect width="5" height="5" x="3" y="16" rx="1"></rect><path d="M21 16h-3a2 2 0 0 0-2 2v3"></path><path d="M21 21v.01"></path><path d="M12 7v3a2 2 0 0 1-2 2H7"></path><path d="M3 12h.01"></path><path d="M12 3h.01"></path><path d="M12 16v.01"></path><path d="M16 12h1"></path><path d="M21 12v.01"></path><path d="M12 21v-1"></path></svg>
                            Share for Requests
                        </div>
                    </div>
                    <div class="p-6 pt-0 flex flex-col items-center gap-4">
                        <p class="text-sm text-center text-muted-foreground">Before sharing, make sure you have set an event to 'Active' to receive requests for the correct event.</p>
                        <div class="flex w-full items-center gap-2">
                            <button class="btn btn-secondary" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-qr-code"><rect width="5" height="5" x="3" y="3" rx="1"></rect><rect width="5" height="5" x="16" y="3" rx="1"></rect><rect width="5" height="5" x="3" y="16" rx="1"></rect><path d="M21 16h-3a2 2 0 0 0-2 2v3"></path><path d="M21 21v.01"></path><path d="M12 7v3a2 2 0 0 1-2 2H7"></path><path d="M3 12h.01"></path><path d="M12 3h.01"></path><path d="M12 16v.01"></path><path d="M16 12h1"></path><path d="M21 12v.01"></path><path d="M12 21v-1"></path></svg>
                                Show QR Code
                            </button>
                            <button class="btn" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"></line><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"></line></svg>
                                Share Link
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="w-full max-w-4xl mx-auto py-8">
            <div class="flex justify-center">
                <a href="/request">
                    <button class="btn underline-offset-4 hover:underline h-10 px-4 py-2 text-muted-foreground hover:text-primary">
                        View request page
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link ml-2 h-4 w-4"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>
                    </button>
                </a>
            </div>
        </footer>
    </div>
    <script>
        let djId = 1; // Replace with actual logged-in DJ ID
        let selectedPartyId = null;
        function showQRModal() {
            document.getElementById('qrModal').style.display = 'block';
            // Generate QR for currently selected party or fallback
            let partyId = selectedPartyId || '';
            let qr = new QRious({
                element: document.getElementById("qrPlaceholder"),
                value: window.location.origin + "/submit.html?partyId=" + partyId,
                size: 200
            });
        }
        function closeQRModal() {
            document.getElementById('qrModal').style.display = 'none';
        }
        function loadParties() {
            let url = 'http://178.128.4.96/LAMPAPI/GetParties.php?djId=' + djId;
            let xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    let jsonObject = JSON.parse(xhr.responseText);
                    let partiesList = document.getElementById("partiesList");
                    partiesList.innerHTML = "";
                    if(jsonObject.parties.length === 0) {
                        document.getElementById("emptyEvents").style.display = '';
                    } else {
                        document.getElementById("emptyEvents").style.display = 'none';
                        jsonObject.parties.forEach(function(party) {
                            let li = document.createElement("li");
                            li.textContent = party.PartyName;
                            li.setAttribute('data-partyid', party.PartyId);
                            li.onclick = function() { selectParty(party.PartyId, party.PartyName, li); };
                            partiesList.appendChild(li);
                        });
                    }
                }
            };
            xhr.send();
        }
        function selectParty(partyId, partyName, liElem) {
            selectedPartyId = partyId;
            // Highlight selected
            let lis = document.querySelectorAll('#partiesList li');
            lis.forEach(function(li){ li.classList.remove('selected'); });
            liElem.classList.add('selected');
        }
        function shareLink() {
            let partyId = selectedPartyId || '';
            let requestUrl = window.location.origin + "/submit.html?partyId=" + partyId;
            if (navigator.share) {
                navigator.share({
                    title: 'Request a Song!',
                    text: 'Scan the QR code or click the link to request a song.',
                    url: requestUrl,
                });
            } else {
                navigator.clipboard.writeText(requestUrl);
                alert('The request link has been copied to your clipboard.');
            }
        }
        window.onload = function() {
            loadParties();
        };
    </script>
    <script>
        // Check if the user is authenticated
        const userToken = localStorage.getItem('userToken');
        if (!userToken) {
            // Redirect to login page if no token is found
            window.location.href = './login.html';
        } else {
            console.log('User authenticated with token:', userToken);
        }
    </script>
</body>
</html>
